const clients = [
    {
        name: 'Gisele Meireles',
        description: 'Descrição da Gisele Meireles',
        photo: 'https://cdn.discordapp.com/attachments/801210889943384105/1128464520185131168/logo.png',
        images: [
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_338756439_602068328649375_970361855913615907_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_338756439_602068328649375_970361855913615907_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_339145169_1269735400298651_4063940089860892140_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_339145169_1269735400298651_4063940089860892140_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342039584_756499279431425_3093297704798233902_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342039584_756499279431425_3093297704798233902_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342065312_698465782053602_7578099195561972987_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342065312_698465782053602_7578099195561972987_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342067728_749248463361735_8298239884568301860_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342067728_749248463361735_8298239884568301860_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342083275_1411824366221165_5357967678716503921_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342083275_1411824366221165_5357967678716503921_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342101572_768162264720561_3240492123577296049_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342101572_768162264720561_3240492123577296049_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342280851_231521492885132_5469276481783619988_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342280851_231521492885132_5469276481783619988_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342373556_888794072225970_6394532793165796485_n_1080 (1).jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342373556_888794072225970_6394532793165796485_n_1080 (1).jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342377721_1322063631704741_5339397734611834695_n_1080 (1).jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/gisela_meireles/images/Snapinsta.app_342377721_1322063631704741_5339397734611834695_n_1080 (1).jpg',
            },
        ]
    },
    {
        name: 'Matheus Staudinger',
        description: 'Descrição do Matheus Staudinger',
        photo: 'https://cdn.discordapp.com/attachments/801210889943384105/1128464553248825424/logo.png',
        images: [
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/m1.png',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/m1.png',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348488684_1034266564203321_7536135470659574564_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348488684_1034266564203321_7536135470659574564_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348647709_1610231812834414_5296188404553254524_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348647709_1610231812834414_5296188404553254524_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348654148_205637658971834_6024116929798325022_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348654148_205637658971834_6024116929798325022_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348662650_127263963697782_6036216806623176685_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348662650_127263963697782_6036216806623176685_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348664033_1380204189487913_7907616534426737778_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348664033_1380204189487913_7907616534426737778_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348670622_937757114157421_4157285723538284629_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348670622_937757114157421_4157285723538284629_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348749239_276612601469460_905745581815246018_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348749239_276612601469460_905745581815246018_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348862042_1804157626646932_7698996856201145835_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_348862042_1804157626646932_7698996856201145835_n_1080.jpg',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_349040524_989746442016645_1782292294069088091_n_1080.jpg',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/matheus_staudinger/images/Snapinsta.app_349040524_989746442016645_1782292294069088091_n_1080.jpg',
            },
        ]
    },
    {
        name: 'Pure Healthy',
        description: 'Descrição da Pure Healthy',
        photo: 'https://cdn.discordapp.com/attachments/801210889943384105/1128464577957470208/logo.png',
        images: [
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p1.png',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p1.png',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p2.png',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p2.png',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p3.png',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p3.png',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p4.png',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p4.png',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p5.png',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p5.png',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p6.png',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p6.png',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p7.png',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p7.png',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p8.png',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p8.png',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p9.png',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p9.png',
            },
            {
                mobile: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p10.png',
                desktop: 'http://localhost/Gabriel%20other%20project/imgs/pure_healthy/images/p10.png',
            },
        ]
    },
].sort(() => {

    return Math.random() - 0.5

})

const alreadyViewed = []
const elements = {
    infosTop: {
        self: document.querySelector('.slide .content .infos-top'),
        foto: document.querySelector('.slide .content .infos-top .foto'),
        clientInfos: {
            self: document.querySelector('.slide .content .infos-top .client-infos'),
            name: document.querySelector('.slide .content .infos-top .client-infos .name'),
            description: document.querySelector('.slide .content .infos-top .client-infos .description')
        },
        btnAction: document.querySelector('.slide .content .infos-top .btn-action')
    },
    slideContainer: {
        self: document.querySelector('.slide .content .slide-container'),
        actions: {
            self: document.querySelector('.slide .content .slide-container .actions'),
            childs: document.querySelectorAll('.slide .content .slide-container .actions .action'),
        },
        images: {
            self: document.querySelector('.slide .content .slide-container .images .group'),
            childs: document.querySelectorAll('.slide .content .slide-container .images .group .image'),
        }
    }
}
const imagesPerView = Number(getComputedStyle(elements.slideContainer.images.self.parentNode).getPropertyValue('--images-quantity').trim())

let dragging = false,
    draggingLeave = false,
    startDrag = 0,
    startTranslate = 0


window.addEventListener('load', async () => {

    const carouselResizeObserver = new ResizeObserver(async (entries) => {

        for (entry of entries){

            const currentImage = Array.from(elements.slideContainer.images.childs).filter((child) => {

                return child.classList.contains('current')
                
            })[0]
            const currentImageIndex = Array.from(elements.slideContainer.images.childs).indexOf(currentImage)

            if(currentImageIndex > 0){

                await scrollCarousel(elements.slideContainer.images.childs[currentImageIndex - 1], 'right')

            }

        }

    })

    carouselResizeObserver.observe(elements.slideContainer.self)

    await renderClientToDOM()

    elements.infosTop.btnAction.addEventListener('click', async () => {

        await renderClientToDOM()
    
    })

    elements.slideContainer.actions.childs.forEach((action) => {

        action.addEventListener('click', async () => {
            
            let currentImage = Array.from(elements.slideContainer.images.childs).filter((image) => {
    
                return image.classList.contains('current')
    
            })[0]

            const currentImageIndex = Array.from(elements.slideContainer.images.childs).indexOf(currentImage)
            const direction = action.dataset.direction

            if((currentImageIndex == 0 && direction == 'left') || (currentImageIndex == elements.slideContainer.images.childs.length - 1 && direction == 'right')){

                return

            }
            
            await scrollCarousel(currentImage, action.dataset.direction)

        })

    })

    elements.slideContainer.images.childs.forEach((image, index) => {

        image.addEventListener('click', async (e) => {

            if(draggingLeave){

                draggingLeave = false

                return

            }
            
            await scrollCarousel(image)

        })

    })

    elements.slideContainer.images.self.addEventListener('mousedown', await dragCarousel('start'))
    elements.slideContainer.images.self.addEventListener('mousemove', await dragCarousel('move'))
    elements.slideContainer.images.self.addEventListener('mouseup', await dragCarousel('end'))
    elements.slideContainer.images.self.addEventListener('mouseleave', await dragCarousel('end'))
    
    elements.slideContainer.images.self.addEventListener('touchstart', await dragCarousel('start'))
    elements.slideContainer.images.self.addEventListener('touchmove', await dragCarousel('move'))
    elements.slideContainer.images.self.addEventListener('touchend', await dragCarousel('end'))
    elements.slideContainer.images.self.addEventListener('touchleave', await dragCarousel('end'))
    elements.slideContainer.images.self.addEventListener('touchcancel', await dragCarousel('end'))

})

async function scrollCarousel(currentImage, direction) {

    await createClones()

    elements.slideContainer.images.childs.forEach((image) => {

        image.classList.remove('hidden')
        image.classList.remove('current')

    })

    const newCurrentImage = direction ? currentImage[`${direction == 'right' ? 'next' : 'previous'}Sibling`] : currentImage
    
    newCurrentImage.classList.add('current')

    const newCurrentImageIndex = Array.from(elements.slideContainer.images.childs).indexOf(newCurrentImage)
    const offset = (newCurrentImage.clientWidth * -(newCurrentImageIndex - 1)) + 'px'

    for(let i = 0; i < newCurrentImageIndex - 1; i++){

        hideImage(elements.slideContainer.images.childs[i], i)

    }

    for(let i = newCurrentImageIndex + 2; i < elements.slideContainer.images.childs.length; i++){

        hideImage(elements.slideContainer.images.childs[i], (i - newCurrentImageIndex))
        
    }
    
    function hideImage(image, distanceOfZero) {

        if(image){
            
            image.classList.add('hidden')
    
        }

    }

    elements.slideContainer.images.self.style.transform = `translateX(${offset})`

    await alternateClones(newCurrentImageIndex)

}

async function dragCarousel(event) {

    try {

        const events = {
            start: async (e) => {
   
                const clientX = (e.clientX) ? e.clientX : e.targetTouches[0].clientX
                
                dragging = true
                startDrag = clientX
                startTranslate = Number(elements.slideContainer.images.self.style.transform.replace(/\D/g, ''))

                console.log('Start dragging')
                
            },
            move: async (e) => {
    
                if(!dragging){
    
                    return
    
                }

                const clientX = (e.clientX) ? e.clientX : e.targetTouches[0].clientX
                
                const mouseOffset = (startDrag - clientX)
                let offset = startTranslate
    
                if(Math.abs(mouseOffset) > elements.slideContainer.images.childs[0].clientWidth / 2){
    
                    offset += mouseOffset
    
                    const currentImage = Array.from(elements.slideContainer.images.childs).filter((image) => {
            
                        return image.classList.contains('current')
            
                    })[0]
    
                    const direction = Math.sign(mouseOffset) > 0 ? 'right' : 'left'
    
                    scrollCarousel(currentImage, direction)
    
                }
    
                elements.slideContainer.images.self.style.transform = `translateX(-${offset}px`;

                console.log('Dragging')
    
            },
            end: async (e) => {
                
                if(!dragging){
                    
                    draggingLeave = true

                }

                startDrag = 0
                dragging = false

                console.log('End Dragging')
                
            },
        }
    
        const eventSelected = events[event]
    
        if(!eventSelected){
    
            throw new Error(`O evento ${event} não existe`)
    
        }
    
        return eventSelected

    } catch(Error) {

        console.error(Error.message)

    }
    
}

async function createClones() {

    let clones = elements.slideContainer.images.self.querySelectorAll('.image.clone')

    if(!clones || clones.length == 0){

        Array.from(elements.slideContainer.images.childs).forEach((image, index, childs) => {

            if(index < imagesPerView){
                
                const cloneImage = image.cloneNode(true)
                
                cloneImage.classList.add('clone')
                
                elements.slideContainer.images.self.appendChild(cloneImage)
                
            } else if(index >= (childs.length - imagesPerView)) {
                
                const cloneImage = image.cloneNode(true)
                
                cloneImage.classList.add('clone')
                
                elements.slideContainer.images.self.insertBefore(cloneImage, childs[0])

            }

        })
        
    }
    
}

async function alternateClones(currentImageIndex) {

    const backupTransition = getComputedStyle(elements.slideContainer.images.self).getPropertyValue('transition')
    const originalMaxImagesChilds = elements.slideContainer.images.childs.length - (imagesPerView * 2)
    
    let newIndex = null,
        direction = null
    
    if(currentImageIndex == 1){

        newIndex = originalMaxImagesChilds + imagesPerView
        direction = 'left'
        
    } else if(currentImageIndex == elements.slideContainer.images.childs.length - 2){
        
        newIndex = imagesPerView - 1
        direction = 'right'
        
    }
    
    if(newIndex){
        
        elements.slideContainer.images.self.style.transition = 'none'
        await scrollCarousel(elements.slideContainer.images.childs[newIndex], direction)
        elements.slideContainer.images.self.style.transition = backupTransition
        
        if(currentImageIndex + 1 < originalMaxImagesChilds || currentImageIndex + 1 > originalMaxImagesChilds){
            
            await scrollCarousel(elements.slideContainer.images.childs[direction == 'left' ? (newIndex - 1) : (newIndex + 1)], direction)

        }

    }
    
}

async function getClient() {

    if(alreadyViewed.length == clients.length){

        while(alreadyViewed.length > 0){

            alreadyViewed.pop()

        }

    }

    const filteredClients = clients.filter((client, index) => {

        return !alreadyViewed.includes(client)

    })

    const client = filteredClients[0]

    alreadyViewed.push(client)

    return client

}

async function renderClientToDOM() {

    elements.slideContainer.images.self.innerHTML = null

    const client = await getClient()

    elements.infosTop.foto.src = client.photo
    elements.infosTop.clientInfos.name.textContent = client.name
    elements.infosTop.clientInfos.description.textContent = client.description

    if(client.images.length > 0){

        client.images.forEach((image, index) => {

            const projectContainer = document.createElement('div')
            const projectdesktop = document.createElement('img')
            const projectmobile = document.createElement('img')
    
            projectContainer.classList.add('image')
    
            projectdesktop.classList.add('desktop')
            projectmobile.classList.add('mobile')
    
            projectdesktop.src = image.desktop
            projectmobile.src = image.mobile
    
            projectContainer.appendChild(projectdesktop)
            projectContainer.appendChild(projectmobile)
            elements.slideContainer.images.self.appendChild(projectContainer)
    
        })

        elements.slideContainer.images.childs = elements.slideContainer.images.self.childNodes

        await scrollCarousel(elements.slideContainer.images.childs[0], 'right')

        elements.slideContainer.images.childs.forEach((image, index) => {

            image.addEventListener('click', async () => {
                
                await scrollCarousel(image)
    
            })
    
        })

    }
    
}